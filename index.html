<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>节奏英语 Rhythm English</title>
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="css/practice.css">
</head>
<body>
<div class="app">
  <div class="hdr">
    <h1>节奏英语</h1>
    <div class="hdr-right">
      <div class="mode-toggle">
        <label>中文</label>
        <button class="toggle" id="cnToggle" onclick="toggleCN()" role="switch" aria-checked="false" aria-label="Toggle Chinese mode"></button>
      </div>
      <div class="xp-display"><span style="font-weight:800;color:var(--acc)">XP</span> <span class="xp-num" id="xpNum">0</span></div>
      <div class="badge" id="dayBadge">Day 1</div>
    </div>
  </div>
  <div class="streak-bar" id="streakBar"></div>
  <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Learning progress" id="progBar"><div class="progress-fill" id="prog"></div></div>
  <div class="complete-summary" id="completeSummary"></div>
  <div class="day-switcher" id="daySwitcher"></div>
  <div class="day-overview" id="dayOverview"></div>
  <div class="category-tabs" id="categoryTabs"></div>
  <div class="card" id="card"></div>
</div>

<!-- Quiz overlay -->
<div class="quiz-overlay" id="quizOverlay" role="dialog" aria-modal="true" aria-label="Quiz">
  <div class="quiz-progress" id="quizProgress" role="progressbar" aria-label="Quiz progress"></div>
  <div id="quizContent"></div>
</div>

<!-- Review overlay (Spaced Repetition) -->
<div class="review-overlay" id="reviewOverlay" role="dialog" aria-modal="true" aria-label="Review">
  <div id="reviewContent"></div>
</div>

<!-- Daily Challenge overlay -->
<div class="challenge-overlay" id="challengeOverlay" role="dialog" aria-modal="true" aria-label="Daily Challenge">
  <div id="challengeContent"></div>
</div>

<!-- Shadowing Mode overlay -->
<div class="shadow-overlay" id="shadowOverlay" role="dialog" aria-modal="true" aria-label="跟读练习">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
    <h2 style="font-size:20px;font-weight:900">跟读练习</h2>
    <button onclick="ShadowMode.close()" style="background:none;border:none;color:var(--dim);font-size:24px;cursor:pointer">&times;</button>
  </div>
  <div id="shadowContent"></div>
</div>

<!-- AI Coach Panel -->
<div class="coach-tab" id="coachTab" onclick="CoachPanel.toggle()">AI 教练</div>
<div class="coach-panel" id="coachPanel">
  <button class="coach-close" onclick="CoachPanel.toggle()">&times;</button>
  <h2 style="font-size:18px;font-weight:900;margin-bottom:4px;background:linear-gradient(135deg,var(--pri),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">AI 教练</h2>
  <p style="font-size:12px;color:var(--dim);margin-bottom:16px">你的专属发音指导</p>
  <div id="coachContent"></div>
</div>

<div class="nav">
  <button class="nav-btn" id="prev" onclick="go(-1)" aria-label="Previous sentence">&#8592;</button>
  <span class="nav-count" id="count" aria-live="polite"></span>
  <button class="nav-btn" id="next" onclick="go(1)" aria-label="Next sentence">&#8594;</button>
  <button class="nav-btn" id="custom" onclick="CustomPractice.show()" aria-label="自由练习" style="margin-left:8px;background:var(--ok)">&#9999;&#65039;</button>
</div>

<!-- Custom Practice Modal -->
<div id="customModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:100;align-items:center;justify-content:center">
  <div style="background:var(--card);padding:24px;border-radius:16px;width:90%;max-width:400px">
    <h3 style="margin-bottom:16px">&#9999;&#65039; 自由练习</h3>
    <p style="color:var(--dim);font-size:13px;margin-bottom:12px">输入任何英语句子来练习发音</p>
    <textarea id="customInput" rows="3" style="width:100%;background:var(--bg);border:1px solid var(--dim);border-radius:8px;color:var(--txt);padding:12px;font-size:16px" placeholder="例如：I need to finish the report by Friday"></textarea>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button onclick="CustomPractice.play(0.8)" style="flex:1;background:var(--pri);color:white;border:none;padding:12px;border-radius:8px;font-weight:600">&#128034; 慢速</button>
      <button onclick="CustomPractice.play(1)" style="flex:1;background:var(--ok);color:white;border:none;padding:12px;border-radius:8px;font-weight:600">&#9654;&#65039; 正常</button>
    </div>
    <div style="margin-top:16px">
      <button onclick="document.getElementById('customModal').style.display='none'" style="width:100%;background:transparent;border:1px solid var(--dim);color:var(--dim);padding:10px;border-radius:8px">关闭</button>
    </div>
  </div>
</div>

<script>
/* Loader protection — show loading state, 10s timeout */
(function(){
  var el=document.createElement('div');
  el.id='_appLoader';
  el.setAttribute('style','position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#0c1021;z-index:9999;gap:16px;padding:24px;text-align:center');
  el.innerHTML='<div style="font-size:40px">&#128214;</div>'
    +'<div style="color:#6366f1;font-size:16px;font-weight:700">正在加载...</div>'
    +'<div style="color:#94a3b8;font-size:13px">首次加载需要几秒钟</div>';
  document.body.appendChild(el);
  window.__loaderTimer=setTimeout(function(){
    var d=document.getElementById('_appLoader');
    if(d)d.innerHTML='<div style="font-size:40px">&#9888;&#65039;</div>'
      +'<div style="color:#ef4444;font-size:16px;font-weight:700;margin-top:8px">加载失败</div>'
      +'<div style="color:#94a3b8;font-size:13px;margin-top:8px;line-height:1.6">请检查网络连接后刷新重试</div>'
      +'<button onclick="location.reload()" style="margin-top:20px;background:#6366f1;color:#fff;border:none;padding:12px 28px;border-radius:24px;font-size:15px;font-weight:700;cursor:pointer">重新加载</button>';
  },10000);
  window.addEventListener('error',function(e){console.error('[AppError]',e.message,'at',e.filename+':'+e.lineno);});
  window.addEventListener('unhandledrejection',function(e){console.error('[UnhandledPromise]',e.reason);});
})();
</script>
<script type="module" src="js/app.js"></script>
</body>
</html>
