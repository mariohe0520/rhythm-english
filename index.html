<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Rhythm English</title>
<link rel="manifest" href="manifest.json">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0f;--card:#14141f;--pri:#6366f1;--acc:#f59e0b;--ok:#10b981;--txt:#f1f5f9;--dim:#64748b;--r:16px}
html,body{height:100%;background:var(--bg);color:var(--txt);font-family:-apple-system,system-ui,sans-serif;-webkit-user-select:none;user-select:none}
.app{display:flex;flex-direction:column;min-height:100%;padding:env(safe-area-inset-top) 16px env(safe-area-inset-bottom)}
/* Header */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:12px 0;position:sticky;top:0;background:var(--bg);z-index:10}
.hdr h1{font-size:18px;font-weight:700}
.hdr .badge{background:var(--pri);padding:4px 12px;border-radius:20px;font-size:13px;font-weight:600}
.progress-bar{height:4px;background:#1e1e2e;border-radius:2px;margin-bottom:8px;position:sticky;top:48px;z-index:10}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--pri),var(--acc));border-radius:2px;transition:width .3s}
/* Card */
.card-wrap{flex:1;display:flex;align-items:flex-start;justify-content:center;position:relative;padding-bottom:80px}
.card{background:var(--card);border-radius:var(--r);padding:28px 24px;width:100%;max-width:400px;transition:transform .3s,opacity .3s}
.card.slide-l{transform:translateX(-120%);opacity:0}
.card.slide-r{transform:translateX(120%);opacity:0}
/* Scene card visual */
.scene-card{background:linear-gradient(135deg,var(--sc1,#6366f1),var(--sc2,#818cf8));border-radius:16px;padding:20px;text-align:center;margin-bottom:16px;position:relative;overflow:hidden}
.scene-card::after{content:'';position:absolute;top:-50%;right:-50%;width:100%;height:100%;background:radial-gradient(circle,rgba(255,255,255,.1) 0%,transparent 70%);pointer-events:none}
.scene-icon{font-size:36px;margin-bottom:4px}
.scene-title{font-size:22px;font-weight:800;color:white;letter-spacing:1px}
.scene-sub{font-size:13px;color:rgba(255,255,255,.8);margin-top:2px}
.cat{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:12px}
/* Stress visual */
.stress-row{display:flex;gap:6px;justify-content:center;align-items:flex-end;margin-bottom:20px;min-height:60px}
.stress-word{display:flex;flex-direction:column;align-items:center;gap:4px}
.stress-dot{border-radius:50%;background:var(--pri);transition:all .3s}
.stress-label{font-size:11px;color:var(--dim)}
/* Sentence */
.sentence{font-size:22px;font-weight:700;text-align:center;line-height:1.4;margin-bottom:6px}
.ipa{font-size:13px;color:var(--dim);text-align:center;margin-bottom:20px;font-family:'Courier New',monospace}
/* Sections */
.section{margin-bottom:16px}
.section-label{font-size:11px;color:var(--acc);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px;font-weight:600}
.section-text{font-size:14px;line-height:1.5;color:var(--txt)}
.trap{color:#f87171;font-style:italic;font-size:13px}
.tip{color:var(--ok);font-size:13px}
/* Variants */
.variants{display:flex;flex-direction:column;gap:6px}
.variant{background:#1a1a2e;padding:8px 12px;border-radius:8px;font-size:13px;border-left:3px solid var(--pri)}
/* Pattern */
.pattern{background:var(--pri);color:white;padding:6px 12px;border-radius:8px;font-size:13px;font-family:'Courier New',monospace;display:inline-block}
/* Chinese reveal */
.cn-reveal{text-align:center;margin-top:12px}
.cn-btn{background:none;border:1px dashed var(--dim);color:var(--dim);padding:6px 16px;border-radius:20px;font-size:12px;cursor:pointer;transition:all .2s}
.cn-btn:active{background:var(--dim);color:var(--bg)}
.cn-text{font-size:14px;color:var(--dim);display:none;margin-top:6px}
.cn-text.show{display:block}
/* Nav */
.nav{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
.nav-btn{background:var(--card);border:none;color:var(--txt);width:48px;height:48px;border-radius:50%;font-size:20px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s}
.nav-btn:active{background:var(--pri)}
.nav-btn:disabled{opacity:.2}
.nav-count{font-size:14px;color:var(--dim)}
/* Audio btn */
.audio-row{display:flex;gap:10px;justify-content:center;margin-bottom:16px}
.audio-btn{background:var(--pri);border:none;color:white;padding:10px 20px;border-radius:24px;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:6px;transition:transform .1s}
.audio-btn:active{transform:scale(.95)}
/* Chinese mode toggle */
.mode-toggle{display:flex;align-items:center;gap:8px;justify-content:center;padding:8px 0}
.mode-toggle label{font-size:12px;color:var(--dim)}
.toggle{position:relative;width:40px;height:22px;background:#1e1e2e;border-radius:11px;cursor:pointer;transition:background .2s}
.toggle.on{background:var(--pri)}
.toggle::after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;background:white;border-radius:50%;transition:left .2s}
.toggle.on::after{left:20px}
/* CN helper text */
.cn-helper{font-size:13px;color:var(--acc);background:#1a1a2e;padding:8px 12px;border-radius:8px;margin-bottom:12px;display:none;text-align:center;border-left:3px solid var(--acc)}
.cn-helper.show{display:block}
</style>
</head>
<body>
<div class="app">
  <div class="hdr">
    <h1>üéµ Rhythm English</h1>
    <div class="badge" id="xp">Day 1</div>
  </div>
  <div class="mode-toggle">
    <label>‰∏≠ÊñáËæÖÂä©</label>
    <div class="toggle" id="cnToggle" onclick="toggleCN()"></div>
  </div>
  <div class="progress-bar"><div class="progress-fill" id="prog"></div></div>
  <div class="card-wrap">
    <div class="card" id="card"></div>
  </div>
  <div class="nav">
    <button class="nav-btn" id="prev" onclick="go(-1)">‚Üê</button>
    <span class="nav-count" id="count"></span>
    <button class="nav-btn" id="next" onclick="go(1)">‚Üí</button>
  </div>
</div>
<script type="module">
import{DAY1,SCENES}from'./data/sentences.js';
let idx=parseInt(localStorage.getItem('re-idx')||'0');
let cnMode=localStorage.getItem('re-cn')==='1';
const $=s=>document.querySelector(s);
let audio=null;

window.toggleCN=function(){
  cnMode=!cnMode;
  localStorage.setItem('re-cn',cnMode?'1':'0');
  $('#cnToggle').classList.toggle('on',cnMode);
  render();
};

function render(){
  const s=DAY1[idx];
  if(!s)return;
  const sc=SCENES[s.id]||{icon:"üí¨",colors:["#6366f1","#818cf8"],title:"",sub:""};
  // init toggle
  $('#cnToggle').classList.toggle('on',cnMode);
  // progress
  $('#prog').style.width=((idx+1)/DAY1.length*100)+'%';
  $('#count').textContent=`${idx+1} / ${DAY1.length}`;
  $('#prev').disabled=idx===0;
  $('#next').disabled=idx===DAY1.length-1;
  // stress dots
  const dots=s.words.map((w,i)=>{
    const size=Math.round(16+s.stress[i]*32);
    const op=(.3+s.stress[i]*.7).toFixed(2);
    return`<div class="stress-word"><div class="stress-dot" style="width:${size}px;height:${size}px;opacity:${op}"></div><span class="stress-label">${s.stress[i]>=.8?w.toUpperCase():w}</span></div>`;
  }).join('');
  // Chinese helper (shown in CN mode)
  const cnHelper=cnMode?`<div class="cn-helper show">üí° ${s.cn}</div>`:'';
  // card
  $('#card').innerHTML=`
    <div class="cat">${s.cat} #${s.id}</div>
    <div class="scene-card" style="--sc1:${sc.colors[0]};--sc2:${sc.colors[1]}">
      <div class="scene-icon">${sc.icon}</div>
      <div class="scene-title">${sc.title}</div>
      <div class="scene-sub">${sc.sub}</div>
    </div>
    ${cnHelper}
    <div class="stress-row">${dots}</div>
    <div class="sentence">${s.text}</div>
    <div class="ipa">${s.ipa}</div>
    <div class="audio-row">
      <button class="audio-btn" onclick="window.speak()">üîä Listen</button>
      <button class="audio-btn" style="background:var(--ok)" onclick="window.speakSlow()">üê¢ Slow</button>
    </div>
    <div class="section">
      <div class="section-label">Meaning</div>
      <div class="section-text">${s.meaning}</div>
    </div>
    <div class="section">
      <div class="section-label">Pattern</div>
      <div class="pattern">${s.pattern}</div>
    </div>
    <div class="section">
      <div class="section-label">Same Pattern</div>
      <div class="variants">${s.variants.map(v=>`<div class="variant">${v}</div>`).join('')}</div>
    </div>
    <div class="section">
      <div class="section-label">‚ö° Rhythm tip</div>
      <div class="tip">${s.tip}</div>
    </div>
    <div class="section">
      <div class="section-label">‚ùå Non-native trap</div>
      <div class="trap">"${s.trap}"</div>
    </div>
    ${!cnMode?`<div class="cn-reveal">
      <button class="cn-btn" onclick="this.nextElementSibling.classList.toggle('show');this.textContent=this.textContent==='Reveal ‰∏≠Êñá'?'Hide':'Reveal ‰∏≠Êñá'">Reveal ‰∏≠Êñá</button>
      <div class="cn-text">${s.cn}</div>
    </div>`:''}
  `;
  localStorage.setItem('re-idx',idx);
}

window.speak=function(){
  if(audio){audio.pause();audio=null;}
  const id=String(DAY1[idx].id).padStart(2,'0');
  audio=new Audio('audio/'+id+'.mp3');
  audio.play().catch(()=>{
    // fallback to speech synthesis
    const u=new SpeechSynthesisUtterance(DAY1[idx].text);
    u.lang='en-US';u.rate=.85;
    speechSynthesis.speak(u);
  });
};

window.speakSlow=function(){
  if(audio){audio.pause();audio=null;}
  const id=String(DAY1[idx].id).padStart(2,'0');
  audio=new Audio('audio/'+id+'.mp3');
  audio.playbackRate=0.7;
  audio.play().catch(()=>{
    const u=new SpeechSynthesisUtterance(DAY1[idx].text);
    u.lang='en-US';u.rate=.55;
    speechSynthesis.speak(u);
  });
};

window.go=function(d){
  const card=$('#card');
  card.classList.add(d>0?'slide-l':'slide-r');
  setTimeout(()=>{
    idx=Math.max(0,Math.min(DAY1.length-1,idx+d));
    card.classList.remove('slide-l','slide-r');
    render();
  },200);
};

// Swipe ‚Äî only horizontal, don't block vertical scroll
let sx=0,sy=0;
document.addEventListener('touchstart',e=>{sx=e.touches[0].clientX;sy=e.touches[0].clientY;},{passive:true});
document.addEventListener('touchend',e=>{
  const dx=e.changedTouches[0].clientX-sx;
  const dy=e.changedTouches[0].clientY-sy;
  // Only trigger swipe if horizontal movement > vertical (not scrolling)
  if(Math.abs(dx)>60 && Math.abs(dx)>Math.abs(dy)*1.5){dx<0?go(1):go(-1)}
},{passive:true});

render();
</script>
</body>
</html>
